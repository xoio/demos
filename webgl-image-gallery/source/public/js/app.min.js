var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(k,u,w){if(w.get||w.set)throw new TypeError("ES3 does not support getters and setters.");k!=Array.prototype&&k!=Object.prototype&&(k[u]=w.value)};$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(k){return $jscomp.SYMBOL_PREFIX+(k||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.iterator;k||(k=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[k]&&$jscomp.defineProperty(Array.prototype,k,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(k){var u=0;return $jscomp.iteratorPrototype(function(){return u<k.length?{done:!1,value:k[u++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(k){$jscomp.initSymbolIterator();k={next:k};k[$jscomp.global.Symbol.iterator]=function(){return this};return k};$jscomp.makeIterator=function(k){$jscomp.initSymbolIterator();var u=k[Symbol.iterator];return u?u.call(k):$jscomp.arrayIterator(k)};$jscomp.arrayFromIterator=function(k){for(var u,w=[];!(u=k.next()).done;)w.push(u.value);return w};$jscomp.arrayFromIterable=function(k){return k instanceof Array?k:$jscomp.arrayFromIterator($jscomp.makeIterator(k))};
$jscomp.owns=function(k,u){return Object.prototype.hasOwnProperty.call(k,u)};$jscomp.polyfill=function(k,u,w,p){if(u){w=$jscomp.global;k=k.split(".");for(p=0;p<k.length-1;p++){var z=k[p];z in w||(w[z]={});w=w[z]}k=k[k.length-1];p=w[k];u=u(p);u!=p&&null!=u&&$jscomp.defineProperty(w,k,{configurable:!0,writable:!0,value:u})}};
$jscomp.polyfill("Object.assign",function(k){return k?k:function(k,w){for(var p=1;p<arguments.length;p++){var u=arguments[p];if(u)for(var t in u)$jscomp.owns(u,t)&&(k[t]=u[t])}return k}},"es6-impl","es3");$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(k){function u(){this.batch_=null}if(k&&!$jscomp.FORCE_POLYFILL_PROMISE)return k;u.prototype.asyncExecute=function(t){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(t);return this};u.prototype.asyncExecuteBatch_=function(){var t=this;this.asyncExecuteFunction(function(){t.executeBatch_()})};var w=$jscomp.global.setTimeout;u.prototype.asyncExecuteFunction=function(t){w(t,0)};u.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var t=
this.batch_;this.batch_=[];for(var k=0;k<t.length;++k){var p=t[k];delete t[k];try{p()}catch(O){this.asyncThrow_(O)}}}this.batch_=null};u.prototype.asyncThrow_=function(k){this.asyncExecuteFunction(function(){throw k;})};var p=function(k){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{k(t.resolve,t.reject)}catch(N){t.reject(N)}};p.prototype.createResolveAndReject_=function(){function k(k){return function(t){u||(u=!0,k.call(p,t))}}var p=this,u=
!1;return{resolve:k(this.resolveTo_),reject:k(this.reject_)}};p.prototype.resolveTo_=function(k){if(k===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(k instanceof p)this.settleSameAsPromise_(k);else{var t;a:switch(typeof k){case "object":t=null!=k;break a;case "function":t=!0;break a;default:t=!1}t?this.resolveToNonPromiseObj_(k):this.fulfill_(k)}};p.prototype.resolveToNonPromiseObj_=function(k){var t=void 0;try{t=k.then}catch(N){this.reject_(N);return}"function"==
typeof t?this.settleSameAsThenable_(t,k):this.fulfill_(k)};p.prototype.reject_=function(k){this.settle_(2,k)};p.prototype.fulfill_=function(k){this.settle_(1,k)};p.prototype.settle_=function(k,p){if(0!=this.state_)throw Error("Cannot settle("+k+", "+p|"): Promise already settled in state"+this.state_);this.state_=k;this.result_=p;this.executeOnSettledCallbacks_()};p.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var k=this.onSettledCallbacks_,p=0;p<k.length;++p)k[p].call(),
k[p]=null;this.onSettledCallbacks_=null}};var z=new u;p.prototype.settleSameAsPromise_=function(k){var p=this.createResolveAndReject_();k.callWhenSettled_(p.resolve,p.reject)};p.prototype.settleSameAsThenable_=function(k,p){var t=this.createResolveAndReject_();try{k.call(p,t.resolve,t.reject)}catch(O){t.reject(O)}};p.prototype.then=function(k,u){function t(k,p){return"function"==typeof k?function(p){try{w(k(p))}catch(R){F(R)}}:p}var w,F,z=new p(function(k,p){w=k;F=p});this.callWhenSettled_(t(k,w),
t(u,F));return z};p.prototype.catch=function(k){return this.then(void 0,k)};p.prototype.callWhenSettled_=function(k,p){function t(){switch(u.state_){case 1:k(u.result_);break;case 2:p(u.result_);break;default:throw Error("Unexpected state: "+u.state_);}}var u=this;null==this.onSettledCallbacks_?z.asyncExecute(t):this.onSettledCallbacks_.push(function(){z.asyncExecute(t)})};p.resolve=function(k){return k instanceof p?k:new p(function(p,u){p(k)})};p.reject=function(k){return new p(function(p,u){u(k)})};
p.race=function(k){return new p(function(u,t){for(var w=$jscomp.makeIterator(k),z=w.next();!z.done;z=w.next())p.resolve(z.value).callWhenSettled_(u,t)})};p.all=function(k){var u=$jscomp.makeIterator(k),t=u.next();return t.done?p.resolve([]):new p(function(k,w){function z(p){return function(u){K[p]=u;F--;0==F&&k(K)}}var K=[],F=0;do K.push(void 0),F++,p.resolve(t.value).callWhenSettled_(z(K.length-1),w),t=u.next();while(!t.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(p.$jscomp$new$AsyncExecutor=function(){return new u});
return p},"es6-impl","es3");
(function(k,u){"object"===typeof exports&&"undefined"!==typeof module?u():"function"===typeof define&&define.amd?define(u):u()})(this,function(){function k(a,b){(window.jraDebug||(void 0===b?0:b))&&console.log("%c "+a,"background:red;color:white; padding-left:2px; padding-right:2px;")}function u(a,b){b=void 0===b?3:b;for(var c=[],d=a.length,e=0;e<d;++e){var f=a[e];3===b?c.push(f[0],f[1],f[2]):c.push(f[0],f[1])}return c=c.map(function(a){return void 0===a||null===a?0:a})}function w(a,b){for(var c=
[];a<b;)c.push(a),a+=1;return c}function p(a,b){a=void 0===a?0:a;return a+Math.random()*((void 0===b?1:b)-a+1)}function z(a,b){a=void 0===a?0:a;return Math.floor(a+Math.random()*((void 0===b?1:b)-a+1))}function t(a,b,c){return b<c?a<b?b:a>c?c:a:a<c?c:a>b?b:a}function F(a){var b={};"OES_texture_float OES_vertex_array_object ANGLE_instanced_arrays OES_texture_half_float OES_texture_float_linear OES_texture_half_float_linear WEBGL_color_buffer_float EXT_color_buffer_half_float OES_standard_derivatives WEBGL_draw_buffers WEBGL_depth_texture".split(" ").forEach(function(c){var d=
a.getExtension(c);null===d&&window.jraDebug&&console.log("%c "+("Unable to get extension "+c+", things might look weird or just plain fail"),"background:yellow;color:red; padding-left:2px; padding-right:2px;");b[c]=d});return b}function N(a,b,c){a=void 0===a?null:a;b=void 0===b?{}:b;c=void 0===c?!1:c;var d=null!==a?a:document.createElement("canvas"),e=!1;a={alpha:!0,antialias:!0,depth:!0};for(var f in a)b.hasOwnProperty(f)&&(a[f]=b[f]);for(f in b)a[f]=b[f];b=a;f=[];f=c?["webgl","experimental-webgl"]:
["webgl2","experimental-webgl2","webgl","experimental-webgl"];c=f.map(function(a){var c=d.getContext(a,b);if(null!==c){if("webgl2"===a||"experimental-webgl2"===a)e=!0;return c}}).filter(function(a){if(void 0!==a)return a});window.hasWebGL2=e?!0:!1;c[0].isWebGL2=e;return c[0]}function O(a){var b=void 0===a?{}:a;a=void 0===b.canvas?null:b.canvas;var c=void 0===b.getCommonExtensions?!0:b.getCommonExtensions,d=void 0===b.width?300:b.width,e=void 0===b.height?150:b.height;a=N(a,void 0===b.ctxOptions?{}:
b.ctxOptions,void 0===b.webgl1?!1:b.webgl1);d=new T(d,e);e={FLOAT:a.FLOAT,UNSIGNED_BYTE:a.UNSIGNED_BYTE,UNSIGNED_SHORT:a.UNSIGNED_SHORT,ARRAY_BUFFER:a.ARRAY_BUFFER,ELEMENT_BUFFER:a.ELEMENT_ARRAY_BUFFER,RGBA:a.RGBA,RGB:a.RGB,RGBA16F:a.RGBA16F,TEXTURE_2D:a.TEXTURE_2D,STATIC_DRAW:a.STATIC_DRAW,DYNAMIC_DRAW:a.DYNAMIC_DRAW,TRIANGLES:a.TRIANGLES,TRIANGLE_STRIP:a.TRIANGLE_STRIP,POINTS:a.POINTS,FRAMEBUFFER:a.FRAMEBUFFER,COLOR_ATTACHMENT0:a.COLOR_ATTACHMENT0,CLAMP_TO_EDGE:a.CLAMP_TO_EDGE,LINEAR:a.LINEAR,NEAREST:a.NEAREST,
MAG_FILTER:a.TEXTURE_MAG_FILTER,MIN_FILTER:a.TEXTURE_MIN_FILTER,WRAP_S:a.TEXTURE_WRAP_S,WRAP_T:a.TEXTURE_WRAP_T,TEXTURE0:a.TEXTURE0,TEXTURE1:a.TEXTURE1,TEXTURE2:a.TEXTURE2,UNIFORM_BUFFER:a.UNIFORM_BUFFER,PI:3.14149,M_PI:3.14149,M_2_PI:3.14149*3.14149,"2_PI":3.14149*3.14149,sin:Math.sin,cos:Math.cos,tan:Math.tan,random:Math.random,randFloat:p,randInt:z,clamp:t,range:w};a instanceof WebGL2RenderingContext&&(e.COLOR_ATTACHMENT1=a.COLOR_ATTACHMENT1,e.COLOR_ATTACHMENT2=a.COLOR_ATTACHMENT2,e.COLOR_ATTACHMENT3=
a.COLOR_ATTACHMENT3,e.COLOR_ATTACHMENT4=a.COLOR_ATTACHMENT4,e.COLOR_ATTACHMENT5=a.COLOR_ATTACHMENT5);if(!window.GL_CONSTANTS_SET){for(var f in e)window[f]=e[f];window.GL_CONSTANTS_SET=!0}f=Object.assign(a.__proto__,d.__proto__);a.__proto__=f;Object.assign(a,d);if(300!==a.width||150!==a.height)a.canvas.width=a.width,a.canvas.height=a.height;if(c&&!a.isWebGL2){var c=F(a),g;for(g in c)a[g]=c[g]}return a}function Y(){var a=l.create(),b=l.create(),c=l.create(),d=n.create(0,0,0),e=n.create(0,0,-1);l.create();
var f=n.create(0,1,0),g=n.create(),h=n.create();return{type:"camera",position:d,projection:a,view:b,inverseView:c,eye:h,center:g,up:f,zoom:0,direction:e,lookAt:function(a,b){b=void 0===b?null:b;this.eye=n.clone(a);this.center=null!==b?n.clone(b):this.center;n.copy(this.position,a);l.identity(this.view);l.lookAt(this.view,a,this.center,this.up)},update:function(a,b,c){this.up=c;this.direction=b;this.lookAt(a)},translate:function(a,b,c){},setProjection:function(a){this.projection=l.clone(a)},setView:function(a){this.view=
l.clone(a)},getProjection:function(){return this.projection},getView:function(){return this.view},getInverseView:function(){l.identity(this.inverseView);return l.invert(this.inverseView,this.view)}}}function aa(a,b,c,d){a=void 0===a?60:a;b=void 0===b?window.innerWidth/window.innerHeight:b;c=void 0===c?.1:c;d=void 0===d?1E4:d;var e=Y();e.lookAt([0,0,0]);e.fov=a;e.near=c;e.far=d;e.aspect=b;e.name="perspective camera";l.perspective(e.projection,a,b,c,d);l.translate(e.view,e.view,[0,0,-10]);return e}
function K(a,b){a.hasOwnProperty("type")&&"camera"===a.type&&(a.zoom=b,a.position=[0,0,b],a.lookAt([0,0,0]),l.translate(a.view,a.view,[0,0,b]));return a}function Z(a,b){var c=void 0===b?{}:b;b=void 0===c.width?128:c.width;var d=void 0===c.height?128:c.height,c=c.depthType,e=a.createTexture(),c=void 0!==c?c:a.DEPTH_COMPONENT;a instanceof WebGL2RenderingContext&&(c=a.DEPTH_COMPONENT16);var f=CLAMP_TO_EDGE,g=CLAMP_TO_EDGE,h=LINEAR,r=LINEAR;a.bindTexture(a.TEXTURE_2D,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
r);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,h);a.texParameteri(TEXTURE_2D,WRAP_S,f);a.texParameteri(TEXTURE_2D,WRAP_T,g);a instanceof WebGLRenderingContext?a.texImage2D(a.TEXTURE_2D,0,c,b,d,0,c,a.UNSIGNED_SHORT,null):a.texImage2D(a.TEXTURE_2D,0,c,b,d,0,a.DEPTH_COMPONENT,a.UNSIGNED_SHORT,null);a.bindTexture(a.TEXTURE_2D,null);return e}function Q(a,b,c){var d=a.createTexture();a.bindTexture(TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,0,c.internalFormat,c.width,c.height,0,c.format,c.texelType,b);
a.texParameteri(TEXTURE_2D,MAG_FILTER,c.magFilter);a.texParameteri(TEXTURE_2D,MIN_FILTER,c.minFilter);a.texParameteri(TEXTURE_2D,WRAP_S,c.wrapS);a.texParameteri(TEXTURE_2D,WRAP_T,c.wrapT);c.generateMipMaps&&a.generateMipmap(TEXTURE_2D);a.bindTexture(TEXTURE_2D,null);d.contents=b;return d}function R(a,b,c){var d=a.createTexture();a.bindTexture(TEXTURE_2D,d);a.texImage2D(TEXTURE_2D,0,c.format,c.format,c.texelType,b);a.texParameteri(TEXTURE_2D,MAG_FILTER,c.magFilter);a.texParameteri(TEXTURE_2D,MIN_FILTER,
c.minFilter);a.texParameteri(TEXTURE_2D,WRAP_S,c.wrapS);a.texParameteri(TEXTURE_2D,WRAP_T,c.wrapT);c.generateMipMaps&&a.generateMipmap(TEXTURE_2D);c.flipY&&a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.bindTexture(TEXTURE_2D,null);d.contents=b;return d}function ba(a){var b=void 0===a?{}:a;a=void 0===b.format?RGBA:b.format;var c=void 0===b.internalFormat?RGBA:b.internalFormat,d=void 0===b.texelType?UNSIGNED_BYTE:b.texelType,e=void 0===b.wrapS?CLAMP_TO_EDGE:b.wrapS,f=void 0===b.wrapT?CLAMP_TO_EDGE:b.wrapT,
g=void 0===b.minFilter?LINEAR:b.minFilter,h=void 0===b.magFilter?LINEAR:b.magFilter,r=void 0===b.generateMipMaps?!1:b.generateMipMaps,b=void 0===b.depth?!1:b.depth;!1!==b&&(b=gl.DEPTH_COMPONENT);return{format:a,internalFormat:c,wrapS:e,wrapT:f,texelType:d,minFilter:g,magFilter:h,generateMipMaps:r,depth:b}}function L(a,b){var c=void 0===b?{}:b;b=c.data;var d=void 0===c.floatingPoint?!1:c.floatingPoint,e=void 0===c.width?128:c.width,f=void 0===c.height?128:c.height,g=void 0===c.randomInit?!1:c.randomInit,
h=null,c=void 0===c.textureFormat?null:c.textureFormat;null===c&&(c=ba());if(void 0===b){b=null;a instanceof WebGL2RenderingContext&&!0===d&&(a.getExtension("EXT_color_buffer_float"),c.internalFormat=a.RGBA16F,c.texelType=a.FLOAT);a instanceof WebGLRenderingContext&&!0===d&&(c.texelType=a.FLOAT);b=c.texelType===FLOAT?new Float32Array(e*f*4):new Uint8Array(e*f*4);if(g){for(d=0;d<e*f*4;d+=4)b[d]=2*Math.random(),b[d+1]=2*Math.random(),b[d+2]=2*Math.random(),b[d+3]=1;c.data=b}c.width=e;c.height=f;h=Q(a,
b,c)}else c.width=e,c.height=f,a instanceof WebGL2RenderingContext&&!0===d&&(a.getExtension("EXT_color_buffer_float"),c.internalFormat=a.RGBA16F,c.texelType=a.FLOAT),a instanceof WebGLRenderingContext&&!0===d&&(c.texelType=a.FLOAT),b instanceof Image&&(h=R(a,b,c)),b instanceof Float32Array&&(h=Q(a,b,c)),b instanceof Uint8Array&&(c.type!==FLOAT&&(c.type=FLOAT),h=Q(a,b,c)),b instanceof Array&&(c.type!==FLOAT&&(c.type=FLOAT),h=Q(a,new Float32Array(b),c)),c.data=b;return{gl:a,texture:h,raw:h,settings:c,
name:"Texture",getTexture:function(){return this.texture},resize:function(b,c){var d=this.settings;this.settings.width=b;this.settings.height=c;var e=this.gl,e=e.getParameter(e.MAX_TEXTURE_SIZE);0>b||b>e||0>c||c>e?(k("Invalid texture shape specified",!0),b=!1):b=!0;b&&(this.bind(),a.texImage2D(TEXTURE_2D,0,d.internalFormat,this.settings.width,this.settings.height,0,d.format,d.texelType,d.data),this.unbind(0))},bind:function(a){var b=this.gl;b.activeTexture(b["TEXTURE"+(void 0===a?0:a)]);b.bindTexture(b.TEXTURE_2D,
this.texture);this.isBound=!0},unbind:function(){a.bindTexture(a.TEXTURE_2D,null)}}}function S(a,b){var c=void 0===b?{}:b;b=void 0===c.data?null:c.data;var d=void 0===c.usage?"STATIC_DRAW":c.usage,e=null,f="ARRAY_BUFFER";!0===(void 0===c.indexed?!1:c.indexed)&&(f="ELEMENT_ARRAY_BUFFER");c=f;f=a[f];d=a[d];e=a.createBuffer();a={gl:a,buffer:e,bufferTypeName:c,type:f,usage:d,raw:function(){return this.buffer},updateBuffer:function(a){a instanceof Array&&(a="ARRAY_BUFFER"===this.bufferTypeName?new Float32Array(a):
new Uint16Array(a));this.bind();this.gl.bufferSubData(this.type,0,a);this.unbind()},fill:function(a,b){b=void 0!==b?b:this.gl.STATIC_DRAW;a instanceof Array&&(a="ARRAY_BUFFER"===this.bufferTypeName?new Float32Array(a):new Uint16Array(a));this.bind();this.gl.bufferData(this.type,a,b);this.unbind();this.data=a},bufferData:function(a){a instanceof Array&&(a="ARRAY_BUFFER"===this.bufferTypeName?new Float32Array(a):new Uint16Array(a));this.gl.bufferData(this.type,a,d);this.data=a},bind:function(){this.gl.bindBuffer(this.type,
this.buffer)},unbind:function(){this.gl.bindBuffer(this.type,null)}};null!==b&&(a.bind(),a.bufferData(b),a.unbind());return a}function ca(a,b){var c=null,d=null;if(void 0===b||b)a instanceof WebGL2RenderingContext?c=a.createVertexArray():(d=a.hasOwnProperty("OES_vertex_array_object")?a.OES_vertex_array_object:a.getExtension("OES_vertex_array_object"),c=d.createVertexArrayOES());return{gl:a,vao:c,ext:d,attributes:{},makeInstancedAttribute:function(b){if(null===a.vertexAttribDivisor||void 0===a.vertexAttribDivisor){var c=
null;if(a.hasOwnProperty("ANGLE_instanced_arrays"))c=a.ANGLE_instanced_arrays;else try{c=a.getExtension("ANGLE_instanced_arrays")}catch(g){return console.error("cannot utilize instanced attributes on this GPU"),!1}c.vertexAttribDivisorANGLE(this.getAttribute(b),1)}else a.vertexAttribDivisor(this.getAttribute(b),1)},setAttributeLocation:function(a,b,c){c=void 0===c?null:c;var d=this.gl;return null===c||void 0===c?d.getAttribLocation(a,b):d.bindAttribLocation(a,c,b)},enableAttributes:function(a){var b=
a.attributes,c;for(c in b){var d=b[c],e=this.attributes.length;d.hasOwnProperty("location")&&(e=d.location);this.addAttribute(a,d.name,d.size,e)}return this},addAttribute:function(a,b,c){var d=void 0===c?{}:c;c=void 0===d.size?3:d.size;var e=d.location,d=void 0===d.dataOptions?{}:d.dataOptions,f=this.attributes.length;a=a instanceof WebGLProgram?a:a.program;void 0===e&&(f=e);e=this.setAttributeLocation(a,b,f);this.attributes[b]={loc:e,enabled:!0,size:c};this.enableAttribute(b);this.setData(b,d);return this},
getAttribute:function(a){return this.attributes[a].loc},vertexAttribPointer:function(a,b){var c=void 0===b?{}:b;b=void 0===c.size?3:c.size;this.gl.vertexAttribPointer(a,b,void 0===c.type?FLOAT:c.type,void 0===c.normalized?!1:c.normalized,void 0===c.stride?0:c.stride,void 0===c.offset?0:c.offset)},enableAttribute:function(a){"number"===typeof a?this.gl.enableVertexAttribArray(a):this.gl.enableVertexAttribArray(this.attributes[a].loc)},disableAttribute:function(a){"number"===typeof a?this.gl.disableVertexAttribArray(a):
this.gl.disableVertexAttribArray(this.attributes[a].loc)},setData:function(b,c){c=void 0===c?{}:c;a.vertexAttribPointer(this.attributes[b].loc,this.attributes[b].size,void 0===c.type?a.FLOAT:c.type,void 0===c.normalized?a.FALSE:c.normalized,void 0===c.stride?0:c.stride,void 0===c.offset?0:c.offset)},bind:function(){a instanceof WebGL2RenderingContext?this.gl.bindVertexArray(this.vao):d.bindVertexArrayOES(this.vao)},unbind:function(){a instanceof WebGL2RenderingContext?this.gl.bindVertexArray(null):
d.bindVertexArrayOES(null)}}}function U(a,b,c){var d=a.createShader(b);b=b===a.FRAGMENT_SHADER?"FRAGMENT":"VERTEX";a.shaderSource(d,c);a.compileShader(d);if(a.getShaderParameter(d,a.COMPILE_STATUS))return d;k("Error in "+b+" shader compilation - "+a.getShaderInfoLog(d),!0);return!1}function da(a,b,c,d){d=void 0===d?null:d;b=U(a,a.VERTEX_SHADER,b);c=U(a,a.FRAGMENT_SHADER,c);if(!1!==b&&!1!==c){var e=a.createProgram();a.attachShader(e,b);a.attachShader(e,c);a.isWebGL2&&null!==d&&a.transformFeedbackVaryings(e,
d.varyings,d.mode);a.linkProgram(e);a.deleteShader(b);a.deleteShader(c);if(a.getProgramParameter(e,a.LINK_STATUS))return e;k("Could not initialize WebGLProgram");throw"Couldn't link shader program - "+a.getProgramInfoLog(e);}}function ea(a,b,c){a=void 0===a?null:a;c=void 0===c?null:c;var d={},e={},f=void 0!==b.precision?b.precision:"highp",g=void 0!==b.version?b.version:"#version 300 es \n";if(null===a)return console.error("createShader requires a WebGL context"),!1;if(!b.hasOwnProperty("vertex")||
!b.hasOwnProperty("fragment"))return k("spec does not contain vertex and/or fragment shader",!0),!1;b.vertex instanceof Array?(a instanceof WebGL2RenderingContext?b.vertex.unshift(g):a instanceof WebGLRenderingContext&&b.vertex.unshift("#version 120 es"),b.vertex=b.vertex.join("")):a instanceof WebGL2RenderingContext&&(b.vertex=g+b.vertex);b.fragment instanceof Array?(b.fragment.unshift("precision "+f+" float;"),a instanceof WebGL2RenderingContext?b.fragment.unshift(g):a instanceof WebGLRenderingContext&&
b.fragment.unshift("#version 120 es \n"),b.fragment=b.fragment.join("")):a instanceof WebGL2RenderingContext&&(b.fragment=g+("\n precision "+f+" float; \n")+b.fragment);var h=da(a,b.vertex,b.fragment,c);if(b.hasOwnProperty("uniforms"))if(b.uniforms instanceof Object&&!b.uniforms instanceof Array)for(var r in b.uniforms)c=b.uniforms[r],f=a.getUniformLocation(h,r),d[r]={},d[r].loc=f,d[r].function=c[0],d[r].value=c[1];else b.uniforms instanceof Array&&b.uniforms.map(function(b){if("string"===typeof b){var c=
a.getUniformLocation(h,b);null!==c&&(d[b]=c)}else if("object"===typeof b){c=null;if(b.hasOwnProperty("buffer"))try{c=a.getUniformBlockIndex(h,b.name)}catch(v){k("Attempt to get UBO location when UBOs are not yet supported by your computer",!0)}else c=a.getUniformLocation(h,b.name);d[b.name]=c}});b.hasOwnProperty("attributes")&&b.attributes.map(function(a){e[a[0]]={size:a[1],name:a[0]};void 0!==a[2]&&(e[a[0]].location=a[2])});return{gl:a,program:h,uniforms:d,attributes:e,bind:function(a){var b=void 0===
a?{}:a;a=void 0===b.camera?null:b.camera;var c=void 0===b.projection?"projectionMatrix":b.projection,b=void 0===b.view?"modelViewMatrix":b.view;this.gl.useProgram(this.program);null!==a&&(this.set4x4Uniform(c,a.projection),this.set4x4Uniform(b,a.view))},setMatrixUniform:function(a,b){this.gl.uniformMatrix4fv(this.uniforms[a],!1,b)},set4x4Uniform:function(a,b){this.gl.uniformMatrix4fv(this.uniforms[a],!1,b)},set3x3Uniform:function(a,b){var c=this.uniforms[a];c instanceof Object?this.gl.uniformMatrix3fv(c.loc,
!1,b):this.gl.uniformMatrix3fv(this.uniforms[a],!1,b)},setTextureUniform:function(a,b){this.gl.uniform1i(this.uniforms[a],b)},getUniform:function(a){return this.uniforms[a]},setVec2:function(a,b,c){this.gl.uniform2f(this.uniforms[a],b,c)},setVec3:function(a,b){this.gl.uniform3fv(this.uniforms[a],b)},setBooleanUniform:function(a,b){this.gl.uniform1i(this.uniforms[a],b)},uniform:function(a,b){void 0!==b.length&&16===b.length?this.set4x4Uniform(a,b):void 0!==b.length&&3===b.length?this.gl.uniform3fv(this.uniforms[a],
b):void 0!==b.length&&2===b.length?this.setVec2(a,b[0],b[1]):void 0!==b.length&&3===b.length?this.setVec3(a,b):this.gl.uniform1f(this.uniforms[a],b)}}}function V(a,b){b=void 0===b?{}:b;var c=void 0===b.textures?[]:b.textures,d=[],e,f=null;b=c.length;a instanceof WebGL2RenderingContext?e=a.getParameter(a.MAX_COLOR_ATTACHMENTS):(f=a.getExtension("WEBGL_draw_buffers"),e=a.getParameter(f.MAX_COLOR_ATTACHMENTS_WEBGL));if(0<b&&b<e)if(b===c.length)for(var g=0;g<b;++g)a instanceof WebGL2RenderingContext?
d.push({texture:c[g],attachPoint:a.COLOR_ATTACHMENT0+g}):d.push({texture:c[g],attachPoint:f["COLOR_ATTACHMENT"+g+"_WEBGL"]});else console.error("fbo.js::createFBOAttachmentFormat - the number of desired attachments doesn't match the number of textures passed in");return{attachments:0<d.length?d:!1,maxAttachments:e,ext:null!==f?f:!1}}function W(a,b){var c=void 0===b?{}:b;b=void 0===c.width?512:c.width;var d=void 0===c.height?512:c.height,e=void 0===c.initTexture?null:c.initTexture,f=void 0===c.depthTexture?
!1:c.depthTexture,c=void 0===c.format?null:c.format,g=a.createFramebuffer(),h=[],r=[],m=null;null!==e?m=e:(null!==c&&!1===c.attachments&&(m=L(a,{width:b,height:d,floatingPoint:!0})),null===c&&(m=L(a,{width:b,height:d,floatingPoint:!0})));a.bindFramebuffer(a.FRAMEBUFFER,g);if(null===c)a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,m.raw,0);else for(var e=c.attachments.length,J=0;J<e;++J){var v=c.attachments[J],k=v.texture,v=v.attachPoint;a.framebufferTexture2D(a.FRAMEBUFFER,
v,a.TEXTURE_2D,k.raw,0);r.push(v);h.push(k)}f&&(b=Z(a,{width:b,height:d}),a.framebufferTexture2D(FRAMEBUFFER,a.DEPTH_ATTACHMENT,TEXTURE_2D,b,0));a:switch(a.checkFramebufferStatus(a.FRAMEBUFFER)){case a.FRAMEBUFFER_UNSUPPORTED:throw Error("gl-fbo: Framebuffer unsupported");case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw Error("gl-fbo: Framebuffer incomplete attachment");case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw Error("gl-fbo: Framebuffer incomplete dimensions");case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw Error("gl-fbo: Framebuffer incomplete missing attachment");
case a.FRAMEBUFFER_COMPLETE:break a;default:console.error("unknown error creating framebuffer")}a.bindFramebuffer(a.FRAMEBUFFER,null);return{gl:a,name:"FBO",drawTexture:m,fbo:g,attachmentPoints:r,attachmentTextures:0<h.length?h:!1,ext:null!==c?c.ext:!1,numAttachments:h.length,getTexture:function(a){a=void 0===a?0:a;return!1!==h&&a<h.length?this.attachmentTextures[a]:m},bind:function(){a.bindFramebuffer(FRAMEBUFFER,g)},unbind:function(){a.bindFramebuffer(FRAMEBUFFER,null)},drawBuffers:function(b){b=
this.ext;a instanceof WebGL2RenderingContext?a.drawBuffers(this.attachmentPoints):!1!==b&&b.drawBuffersWEBGL(this.attachmentPoints)},getColorAttachmentTexture:function(a){return this.attachmentTextures[void 0===a?0:a]},bindTexture:function(a){this.drawTexture.bind(void 0===a?0:a)},bindAttachmentTextures:function(){for(var a=0;a<this.numAttachments;++a)this.attachmentTextures[a].bind(a)},resize:function(a,b){a=void 0===a?window.innerWidth:a;b=void 0===b?window.innerHeight:b;this.drawTexture.resize(a,
b)},unbindTexture:function(){a.bindTexture(a.TEXTURE_2D,null)}}}function fa(a,b){return new Promise(function(c,d){var e=new FileReader;e.readAsDataURL(b.rawResult);e.onloadend=function(){b.base64=e.result;var d=new Image;d.src=e.result;var g;d.onload=function(){g=L(a,{data:d});b.texture=g;c(b)}}})}function ga(){return navigator.serviceWorker.register("./service-worker.js").then(function(a){console.log("Successful - ",a)},function(a){console.log("unable to register - ",a)})}function X(){(new P).loadManifest(ha).onComplete(function(a){new M(a)})}
window.jraDebug=!1;window.toggleDebug=function(){window.jraDebug=!window.jraDebug};var T=function(a,b){this.viewportY=this.viewportX=0;this.clear_color=[0,0,0,1];this.width=a;this.height=b};T.prototype={attachToScreen:function(a){a=void 0===a?document.body:a;a.appendChild(this.canvas);return this},anchorToScreen:function(a){a=void 0===a?document.body:a;this.attachToScreen(a)},enableBlending:function(){this.enable(this.BLEND)},setBlendFunction:function(a,b){this.blendFunc(this[a],this[b])},enableAlphaBlending:function(){this.enable(this.BLEND);
this.setBlendFunction("SRC_ALPHA","ONE")},testAdditive:function(){this.enable(this.BLEND);this.blendFunc(this.ONE,this.ONE)},enableAdditiveBlending:function(){this.enable(this.BLEND);this.blendEquationSeparate(this.FUNC_ADD,this.FUNC_ADD);this.blendFuncSeparate(this.ONE,this.ONE,this.ONE,this.ONE)},setSize:function(a,b){a=void 0===a?window.innerWidth:a;b=void 0===b?window.innerHeight:b;this.canvas.width=a;this.canvas.height=b;return this},blendLayers:function(){this.setBlendFunction("ONE","ONE_MINUS_SRC_ALPHA")},
disableBlending:function(){this.disable(this.BLEND)},enableInstancedAttribute:function(a,b){b=void 0===b?1:b;this.isWebGL2?this.vertexAttribDivisor(a,b):this.hasOwnProperty("ANGLE_instanced_arrays")?this.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(a,b):console.warn("Current GPU does not support the ANGLE_instance_arrays extension");return this},disableInstancedAttribute:function(a){this.isWebGL2?this.vertexAttribDivisor(a,0):this.hasOwnProperty("ANGLE_instance_arrays")?this.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(a,
0):console.warn("Current GPU does not support the ANGLE_instance_arrays extension")},drawInstancedArrays:function(a,b,c,d){this.isWebGL2?this.drawArraysInstanced(a,b,c,d):this.hasOwnProperty("ANGLE_instanced_arrays")?this.ANGLE_instanced_arrays.drawArraysInstancedANGLE(a,b,c,d):console.error("Unable to draw instanced geometry - extension is not available")},drawInstancedElements:function(a,b,c,d){var e=void 0===d?{}:d;d=void 0===e.type?UNSIGNED_SHORT:e.type;e=void 0===e.offset?0:e.offset;this.isWebGL2?
this.drawElementsInstanced(a,b,d,e,c):this.hasOwnProperty("ANGLE_instanced_arrays")?this.ANGLE_instanced_arrays.drawElementsInstancedANGLE(a,b,d,e,c):console.error("Unable to draw instanced geometry - extension is not available")},setFullscreen:function(a){a=void 0===a?null:a;var b=this;this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.setViewport();a?window.addEventListener("resize",a):window.addEventListener("resize",function(){b.canvas.width=window.innerWidth;b.canvas.height=
window.innerHeight;b.setViewport()});return this},clearScreen:function(a,b,c,d){this.clearColor(void 0===a?0:a,void 0===b?0:b,void 0===c?0:c,void 0===d?1:d);this.viewport(this.viewportX,this.viewportY,this.canvas.width,this.canvas.height);this.clear(this.COLOR_BUFFER_BIT|this.DEPTH_BUFFER_BIT);return this},clearTextures:function(){this.bindTexture(this.TEXTURE_2D,null)},clearTransparent:function(a,b,c,d){this.clearColor(void 0===a?0:a,void 0===b?0:b,void 0===c?0:c,void 0===d?0:d);this.viewport(this.viewportX,
this.viewportY,this.canvas.width,this.canvas.height);this.clear(this.COLOR_BUFFER_BIT);return this},setClearColor:function(a,b,c,d){this.clearColor(void 0===a?0:a,void 0===b?0:b,void 0===c?0:c,void 0===d?1:d)},enableDepth:function(){this.enable(this.DEPTH_TEST);return this},disableDepth:function(){this.disable(this.DEPTH_TEST)},getMaxTextureSize:function(){return this.getParameter(this.gl.MAX_TEXTURE_SIZE)},setViewport:function(a,b,c,d){c=void 0===c?window.innerWidth:c;d=void 0===d?window.innerHeight:
d;this.viewport(void 0===a?0:a,void 0===b?0:b,c,d)},applyCameraUniforms:function(a,b,c){var d=void 0===c?{}:c;c=void 0===d.projection?"projection":d.projection;d=void 0===d.view?"view":d.view;a.set4x4Uniform(c,b.projection);a.set4x4Uniform(d,b.view)}};var q={EPSILON:.000001};q.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;q.RANDOM=Math.random;q.ENABLE_SIMD=!1;q.SIMD_AVAILABLE=q.ARRAY_TYPE===window.Float32Array&&"SIMD"in window;q.USE_SIMD=q.ENABLE_SIMD&&q.SIMD_AVAILABLE;q.setMatrixArrayType=
function(a){q.ARRAY_TYPE=a};var ia=Math.PI/180;q.toRadian=function(a){return a*ia};q.equals=function(a,b){return Math.abs(a-b)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};var l={scalar:{},SIMD:{},create:function(){var a=new q.ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var b=new q.ARRAY_TYPE(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=
a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},fromValues:function(a,b,c,d,e,f,g,h,r,m,J,v,k,D,l,p){var I=new q.ARRAY_TYPE(16);I[0]=a;I[1]=b;I[2]=c;I[3]=d;I[4]=e;I[5]=f;I[6]=g;I[7]=h;I[8]=r;I[9]=m;I[10]=J;I[11]=v;I[12]=k;I[13]=D;I[14]=l;I[15]=p;return I},
set:function(a,b,c,d,e,f,g,h,r,m,J,v,k,D,l,p,n){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=f;a[5]=g;a[6]=h;a[7]=r;a[8]=m;a[9]=J;a[10]=v;a[11]=k;a[12]=D;a[13]=l;a[14]=p;a[15]=n;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}};l.scalar.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=f;a[11]=b[14];
a[12]=e;a[13]=g;a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};l.SIMD.transpose=function(a,b){var c,d,e,f,g,h;c=SIMD.Float32x4.load(b,0);d=SIMD.Float32x4.load(b,4);e=SIMD.Float32x4.load(b,8);b=SIMD.Float32x4.load(b,12);f=SIMD.Float32x4.shuffle(c,d,0,1,4,5);g=SIMD.Float32x4.shuffle(e,b,0,1,4,5);h=SIMD.Float32x4.shuffle(f,g,0,2,4,6);f=SIMD.Float32x4.shuffle(f,
g,1,3,5,7);SIMD.Float32x4.store(a,0,h);SIMD.Float32x4.store(a,4,f);f=SIMD.Float32x4.shuffle(c,d,2,3,6,7);g=SIMD.Float32x4.shuffle(e,b,2,3,6,7);c=SIMD.Float32x4.shuffle(f,g,0,2,4,6);d=SIMD.Float32x4.shuffle(f,g,1,3,5,7);SIMD.Float32x4.store(a,8,c);SIMD.Float32x4.store(a,12,d);return a};l.transpose=q.USE_SIMD?l.SIMD.transpose:l.scalar.transpose;l.scalar.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],r=b[6],m=b[7],J=b[8],v=b[9],k=b[10],l=b[11],p=b[12],n=b[13],q=b[14];b=b[15];var u=
c*h-d*g,t=c*r-e*g,B=c*m-f*g,C=d*r-e*h,A=d*m-f*h,w=e*m-f*r,x=J*n-v*p,y=J*q-k*p,H=J*b-l*p,z=v*q-k*n,E=v*b-l*n,F=k*b-l*q,G=u*F-t*E+B*z+C*H-A*y+w*x;if(!G)return null;G=1/G;a[0]=(h*F-r*E+m*z)*G;a[1]=(e*E-d*F-f*z)*G;a[2]=(n*w-q*A+b*C)*G;a[3]=(k*A-v*w-l*C)*G;a[4]=(r*H-g*F-m*y)*G;a[5]=(c*F-e*H+f*y)*G;a[6]=(q*B-p*w-b*t)*G;a[7]=(J*w-k*B+l*t)*G;a[8]=(g*E-h*H+m*x)*G;a[9]=(d*H-c*E-f*x)*G;a[10]=(p*A-n*B+b*u)*G;a[11]=(v*B-J*A-l*u)*G;a[12]=(h*y-g*z-r*x)*G;a[13]=(c*z-d*y+e*x)*G;a[14]=(n*t-p*C-q*u)*G;a[15]=(J*C-v*
t+k*u)*G;return a};l.SIMD.invert=function(a,b){var c,d,e,f,g,h,r,m;g=SIMD.Float32x4.load(b,0);h=SIMD.Float32x4.load(b,4);r=SIMD.Float32x4.load(b,8);m=SIMD.Float32x4.load(b,12);b=SIMD.Float32x4.shuffle(g,h,0,1,4,5);d=SIMD.Float32x4.shuffle(r,m,0,1,4,5);c=SIMD.Float32x4.shuffle(b,d,0,2,4,6);d=SIMD.Float32x4.shuffle(d,b,1,3,5,7);b=SIMD.Float32x4.shuffle(g,h,2,3,6,7);f=SIMD.Float32x4.shuffle(r,m,2,3,6,7);e=SIMD.Float32x4.shuffle(b,f,0,2,4,6);f=SIMD.Float32x4.shuffle(f,b,1,3,5,7);b=SIMD.Float32x4.mul(e,
f);b=SIMD.Float32x4.swizzle(b,1,0,3,2);g=SIMD.Float32x4.mul(d,b);h=SIMD.Float32x4.mul(c,b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);g=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,b),g);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,b),h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);b=SIMD.Float32x4.mul(d,e);b=SIMD.Float32x4.swizzle(b,1,0,3,2);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,b),g);m=SIMD.Float32x4.mul(c,b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(f,b));m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,
b),m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);b=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,3,0,1),f);b=SIMD.Float32x4.swizzle(b,1,0,3,2);e=SIMD.Float32x4.swizzle(e,2,3,0,1);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,b),g);r=SIMD.Float32x4.mul(c,b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(e,b));r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,b),r);r=SIMD.Float32x4.swizzle(r,2,3,0,1);b=SIMD.Float32x4.mul(c,d);b=SIMD.Float32x4.swizzle(b,1,0,3,2);r=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,
b),r);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,b),m);b=SIMD.Float32x4.swizzle(b,2,3,0,1);r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,b),r);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(e,b));b=SIMD.Float32x4.mul(c,f);b=SIMD.Float32x4.swizzle(b,1,0,3,2);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(e,b));r=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,b),r);b=SIMD.Float32x4.swizzle(b,2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,b),h);r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(d,b));b=SIMD.Float32x4.mul(c,e);
b=SIMD.Float32x4.swizzle(b,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,b),h);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(d,b));b=SIMD.Float32x4.swizzle(b,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(f,b));m=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,b),m);c=SIMD.Float32x4.mul(c,g);c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,2,3,0,1),c);c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,1,0,3,2),c);b=SIMD.Float32x4.reciprocalApproximation(c);c=SIMD.Float32x4.sub(SIMD.Float32x4.add(b,b),SIMD.Float32x4.mul(c,
SIMD.Float32x4.mul(b,b)));c=SIMD.Float32x4.swizzle(c,0,0,0,0);if(!c)return null;SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(c,g));SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(c,h));SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(c,r));SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(c,m));return a};l.invert=q.USE_SIMD?l.SIMD.invert:l.scalar.invert;l.scalar.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],r=b[6],m=b[7],k=b[8],v=b[9],l=b[10],D=b[11],p=b[12],n=b[13],q=b[14];b=b[15];a[0]=h*
(l*b-D*q)-v*(r*b-m*q)+n*(r*D-m*l);a[1]=-(d*(l*b-D*q)-v*(e*b-f*q)+n*(e*D-f*l));a[2]=d*(r*b-m*q)-h*(e*b-f*q)+n*(e*m-f*r);a[3]=-(d*(r*D-m*l)-h*(e*D-f*l)+v*(e*m-f*r));a[4]=-(g*(l*b-D*q)-k*(r*b-m*q)+p*(r*D-m*l));a[5]=c*(l*b-D*q)-k*(e*b-f*q)+p*(e*D-f*l);a[6]=-(c*(r*b-m*q)-g*(e*b-f*q)+p*(e*m-f*r));a[7]=c*(r*D-m*l)-g*(e*D-f*l)+k*(e*m-f*r);a[8]=g*(v*b-D*n)-k*(h*b-m*n)+p*(h*D-m*v);a[9]=-(c*(v*b-D*n)-k*(d*b-f*n)+p*(d*D-f*v));a[10]=c*(h*b-m*n)-g*(d*b-f*n)+p*(d*m-f*h);a[11]=-(c*(h*D-m*v)-g*(d*D-f*v)+k*(d*m-f*
h));a[12]=-(g*(v*q-l*n)-k*(h*q-r*n)+p*(h*l-r*v));a[13]=c*(v*q-l*n)-k*(d*q-e*n)+p*(d*l-e*v);a[14]=-(c*(h*q-r*n)-g*(d*q-e*n)+p*(d*r-e*h));a[15]=c*(h*l-r*v)-g*(d*l-e*v)+k*(d*r-e*h);return a};l.SIMD.adjoint=function(a,b){var c,d,e,f,g,h,r,m;c=SIMD.Float32x4.load(b,0);d=SIMD.Float32x4.load(b,4);e=SIMD.Float32x4.load(b,8);f=SIMD.Float32x4.load(b,12);h=SIMD.Float32x4.shuffle(c,d,0,1,4,5);g=SIMD.Float32x4.shuffle(e,f,0,1,4,5);b=SIMD.Float32x4.shuffle(h,g,0,2,4,6);g=SIMD.Float32x4.shuffle(g,h,1,3,5,7);h=SIMD.Float32x4.shuffle(c,
d,2,3,6,7);d=SIMD.Float32x4.shuffle(e,f,2,3,6,7);c=SIMD.Float32x4.shuffle(h,d,0,2,4,6);d=SIMD.Float32x4.shuffle(d,h,1,3,5,7);h=SIMD.Float32x4.mul(c,d);h=SIMD.Float32x4.swizzle(h,1,0,3,2);e=SIMD.Float32x4.mul(g,h);f=SIMD.Float32x4.mul(b,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,h),e);f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,h),f);f=SIMD.Float32x4.swizzle(f,2,3,0,1);h=SIMD.Float32x4.mul(g,c);h=SIMD.Float32x4.swizzle(h,1,0,3,2);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,
h),e);m=SIMD.Float32x4.mul(b,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(d,h));m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,h),m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,3,0,1),d);h=SIMD.Float32x4.swizzle(h,1,0,3,2);c=SIMD.Float32x4.swizzle(c,2,3,0,1);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),e);r=SIMD.Float32x4.mul(b,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(c,h));r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,
h),r);r=SIMD.Float32x4.swizzle(r,2,3,0,1);h=SIMD.Float32x4.mul(b,g);h=SIMD.Float32x4.swizzle(h,1,0,3,2);r=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),r);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,h),m);h=SIMD.Float32x4.swizzle(h,2,3,0,1);r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,h),r);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(c,h));h=SIMD.Float32x4.mul(b,d);h=SIMD.Float32x4.swizzle(h,1,0,3,2);f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(c,h));r=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,h),r);h=SIMD.Float32x4.swizzle(h,
2,3,0,1);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),f);r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(g,h));h=SIMD.Float32x4.mul(b,c);h=SIMD.Float32x4.swizzle(h,1,0,3,2);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),f);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(g,h));h=SIMD.Float32x4.swizzle(h,2,3,0,1);f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(d,h));m=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,h),m);SIMD.Float32x4.store(a,0,e);SIMD.Float32x4.store(a,4,f);SIMD.Float32x4.store(a,8,r);SIMD.Float32x4.store(a,
12,m);return a};l.adjoint=q.USE_SIMD?l.SIMD.adjoint:l.scalar.adjoint;l.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],r=a[7],m=a[8],k=a[9],v=a[10],l=a[11],D=a[12],n=a[13],p=a[14];a=a[15];return(b*g-c*f)*(v*a-l*p)-(b*h-d*f)*(k*a-l*n)+(b*r-e*f)*(k*p-v*n)+(c*h-d*g)*(m*a-l*D)-(c*r-e*g)*(m*p-v*D)+(d*r-e*h)*(m*n-k*D)};l.SIMD.multiply=function(a,b,c){var d=SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8);b=SIMD.Float32x4.load(b,12);var g=SIMD.Float32x4.load(c,
0),g=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,3,3,3,3),b))));SIMD.Float32x4.store(a,0,g);g=SIMD.Float32x4.load(c,4);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,
2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,3,3,3,3),b))));SIMD.Float32x4.store(a,4,g);g=SIMD.Float32x4.load(c,8);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,3,3,3,3),b))));SIMD.Float32x4.store(a,8,g);c=SIMD.Float32x4.load(c,12);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,
0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),b))));SIMD.Float32x4.store(a,12,d);return a};l.scalar.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],r=b[5],m=b[6],k=b[7],v=b[8],l=b[9],D=b[10],n=b[11],p=b[12],q=b[13],u=b[14];b=b[15];var t=c[0],B=c[1],C=c[2],A=c[3];a[0]=t*d+B*h+C*v+A*p;a[1]=t*e+B*r+C*l+A*q;a[2]=t*f+B*
m+C*D+A*u;a[3]=t*g+B*k+C*n+A*b;t=c[4];B=c[5];C=c[6];A=c[7];a[4]=t*d+B*h+C*v+A*p;a[5]=t*e+B*r+C*l+A*q;a[6]=t*f+B*m+C*D+A*u;a[7]=t*g+B*k+C*n+A*b;t=c[8];B=c[9];C=c[10];A=c[11];a[8]=t*d+B*h+C*v+A*p;a[9]=t*e+B*r+C*l+A*q;a[10]=t*f+B*m+C*D+A*u;a[11]=t*g+B*k+C*n+A*b;t=c[12];B=c[13];C=c[14];A=c[15];a[12]=t*d+B*h+C*v+A*p;a[13]=t*e+B*r+C*l+A*q;a[14]=t*f+B*m+C*D+A*u;a[15]=t*g+B*k+C*n+A*b;return a};l.multiply=q.USE_SIMD?l.SIMD.multiply:l.scalar.multiply;l.mul=l.multiply;l.scalar.translate=function(a,b,c){var d=
c[0],e=c[1];c=c[2];var f,g,h,r,m,k,v,l,n,p,q,t;b===a?(a[12]=b[0]*d+b[4]*e+b[8]*c+b[12],a[13]=b[1]*d+b[5]*e+b[9]*c+b[13],a[14]=b[2]*d+b[6]*e+b[10]*c+b[14],a[15]=b[3]*d+b[7]*e+b[11]*c+b[15]):(f=b[0],g=b[1],h=b[2],r=b[3],m=b[4],k=b[5],v=b[6],l=b[7],n=b[8],p=b[9],q=b[10],t=b[11],a[0]=f,a[1]=g,a[2]=h,a[3]=r,a[4]=m,a[5]=k,a[6]=v,a[7]=l,a[8]=n,a[9]=p,a[10]=q,a[11]=t,a[12]=f*d+m*e+n*c+b[12],a[13]=g*d+k*e+p*c+b[13],a[14]=h*d+v*e+q*c+b[14],a[15]=r*d+l*e+t*c+b[15]);return a};l.SIMD.translate=function(a,b,c){var d=
SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12);c=SIMD.Float32x4(c[0],c[1],c[2],0);b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11]);d=SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(c,0,0,0,0));e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(c,1,1,1,1));f=SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(c,2,2,2,2));b=SIMD.Float32x4.add(d,SIMD.Float32x4.add(e,SIMD.Float32x4.add(f,
g)));SIMD.Float32x4.store(a,12,b);return a};l.translate=q.USE_SIMD?l.SIMD.translate:l.scalar.translate;l.scalar.scale=function(a,b,c){var d=c[0],e=c[1];c=c[2];a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};l.SIMD.scale=function(a,b,c){var d;c=SIMD.Float32x4(c[0],c[1],c[2],0);d=SIMD.Float32x4.load(b,0);SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(d,
SIMD.Float32x4.swizzle(c,0,0,0,0)));d=SIMD.Float32x4.load(b,4);SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(c,1,1,1,1)));d=SIMD.Float32x4.load(b,8);SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(c,2,2,2,2)));a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};l.scale=q.USE_SIMD?l.SIMD.scale:l.scalar.scale;l.rotate=function(a,b,c,d){var e=d[0],f=d[1];d=d[2];var g=Math.sqrt(e*e+f*f+d*d),h,r,m,k,v,l,n,p,t,u,w,x,B,C,A,y,z,E,H,F;if(Math.abs(g)<q.EPSILON)return null;
g=1/g;e*=g;f*=g;d*=g;h=Math.sin(c);r=Math.cos(c);m=1-r;c=b[0];g=b[1];k=b[2];v=b[3];l=b[4];n=b[5];p=b[6];t=b[7];u=b[8];w=b[9];x=b[10];B=b[11];C=e*e*m+r;A=f*e*m+d*h;y=d*e*m-f*h;z=e*f*m-d*h;E=f*f*m+r;H=d*f*m+e*h;F=e*d*m+f*h;e=f*d*m-e*h;f=d*d*m+r;a[0]=c*C+l*A+u*y;a[1]=g*C+n*A+w*y;a[2]=k*C+p*A+x*y;a[3]=v*C+t*A+B*y;a[4]=c*z+l*E+u*H;a[5]=g*z+n*E+w*H;a[6]=k*z+p*E+x*H;a[7]=v*z+t*E+B*H;a[8]=c*F+l*e+u*f;a[9]=g*F+n*e+w*f;a[10]=k*F+p*e+x*f;a[11]=v*F+t*e+B*f;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);
return a};l.scalar.rotateX=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[4],f=b[5],g=b[6],h=b[7],r=b[8],m=b[9],k=b[10],l=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=e*c+r*d;a[5]=f*c+m*d;a[6]=g*c+k*d;a[7]=h*c+l*d;a[8]=r*c-e*d;a[9]=m*c-f*d;a[10]=k*c-g*d;a[11]=l*c-h*d;return a};l.SIMD.rotateX=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],
a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var e=SIMD.Float32x4.load(b,4);b=SIMD.Float32x4.load(b,8);SIMD.Float32x4.store(a,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(e,c),SIMD.Float32x4.mul(b,d)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,c),SIMD.Float32x4.mul(e,d)));return a};l.rotateX=q.USE_SIMD?l.SIMD.rotateX:l.scalar.rotateX;l.scalar.rotateY=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[0],f=b[1],g=b[2],h=b[3],r=b[8],m=b[9],k=b[10],l=b[11];b!==a&&(a[4]=b[4],
a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*c-r*d;a[1]=f*c-m*d;a[2]=g*c-k*d;a[3]=h*c-l*d;a[8]=e*d+r*c;a[9]=f*d+m*c;a[10]=g*d+k*c;a[11]=h*d+l*c;return a};l.SIMD.rotateY=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var e=SIMD.Float32x4.load(b,0);b=SIMD.Float32x4.load(b,8);SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,
c),SIMD.Float32x4.mul(b,d)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(e,d),SIMD.Float32x4.mul(b,c)));return a};l.rotateY=q.USE_SIMD?l.SIMD.rotateY:l.scalar.rotateY;l.scalar.rotateZ=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var e=b[0],f=b[1],g=b[2],h=b[3],r=b[4],m=b[5],k=b[6],l=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*c+r*d;a[1]=f*c+m*d;a[2]=g*c+k*d;a[3]=h*c+l*d;a[4]=r*c-e*d;a[5]=m*c-f*d;a[6]=k*c-g*
d;a[7]=l*c-h*d;return a};l.SIMD.rotateZ=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var e=SIMD.Float32x4.load(b,0);b=SIMD.Float32x4.load(b,4);SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(e,c),SIMD.Float32x4.mul(b,d)));SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,c),SIMD.Float32x4.mul(e,d)));return a};l.rotateZ=q.USE_SIMD?
l.SIMD.rotateZ:l.scalar.rotateZ;l.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};l.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};l.fromRotation=function(a,b,c){var d=c[0],e=c[1];c=c[2];var f=Math.sqrt(d*d+e*e+c*c),g;if(Math.abs(f)<q.EPSILON)return null;f=1/f;d*=f;
e*=f;c*=f;f=Math.sin(b);b=Math.cos(b);g=1-b;a[0]=d*d*g+b;a[1]=e*d*g+c*f;a[2]=c*d*g-e*f;a[3]=0;a[4]=d*e*g-c*f;a[5]=e*e*g+b;a[6]=c*e*g+d*f;a[7]=0;a[8]=d*c*g+e*f;a[9]=e*c*g-d*f;a[10]=c*c*g+b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};l.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};l.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=
0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};l.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};l.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,r=e+e,m=f+f;b=d*h;var k=d*r,d=d*m,l=e*r,e=e*m,f=f*m,h=g*h,r=g*r,g=g*m;a[0]=1-(l+f);a[1]=k+g;a[2]=d-r;a[3]=0;a[4]=
k-g;a[5]=1-(b+f);a[6]=e+h;a[7]=0;a[8]=d+r;a[9]=e-h;a[10]=1-(b+l);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};l.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};l.getRotation=function(a,b){var c=b[0]+b[5]+b[10];0<c?(c=2*Math.sqrt(c+1),a[3]=.25*c,a[0]=(b[6]-b[9])/c,a[1]=(b[8]-b[2])/c,a[2]=(b[1]-b[4])/c):b[0]>b[5]&b[0]>b[10]?(c=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/c,a[0]=.25*c,a[1]=(b[1]+b[4])/c,a[2]=(b[8]+b[2])/c):b[5]>b[10]?(c=2*Math.sqrt(1+b[5]-b[0]-
b[10]),a[3]=(b[8]-b[2])/c,a[0]=(b[1]+b[4])/c,a[1]=.25*c,a[2]=(b[6]+b[9])/c):(c=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/c,a[0]=(b[8]+b[2])/c,a[1]=(b[6]+b[9])/c,a[2]=.25*c);return a};l.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],r=e+e,m=f+f,k=g+g;b=e*r;var l=e*m,e=e*k,n=f*m,f=f*k,g=g*k,r=h*r,m=h*m,h=h*k,k=d[0],p=d[1];d=d[2];a[0]=(1-(n+g))*k;a[1]=(l+h)*k;a[2]=(e-m)*k;a[3]=0;a[4]=(l-h)*p;a[5]=(1-(b+g))*p;a[6]=(f+r)*p;a[7]=0;a[8]=(e+m)*d;a[9]=(f-r)*d;a[10]=(1-
(b+n))*d;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};l.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],r=b[3],m=f+f,k=g+g,l=h+h;b=f*m;var n=f*k,f=f*l,p=g*k,g=g*l,h=h*l,m=r*m,k=r*k,r=r*l,l=d[0],q=d[1];d=d[2];var t=e[0],u=e[1];e=e[2];a[0]=(1-(p+h))*l;a[1]=(n+r)*l;a[2]=(f-k)*l;a[3]=0;a[4]=(n-r)*q;a[5]=(1-(b+h))*q;a[6]=(g+m)*q;a[7]=0;a[8]=(f+k)*d;a[9]=(g-m)*d;a[10]=(1-(b+p))*d;a[11]=0;a[12]=c[0]+t-(a[0]*t+a[4]*u+a[8]*e);a[13]=c[1]+u-(a[1]*t+a[5]*u+a[9]*e);
a[14]=c[2]+e-(a[2]*t+a[6]*u+a[10]*e);a[15]=1;return a};l.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=c+c,g=d+d,h=e+e,c=c*f,r=d*f,d=d*g,m=e*f,k=e*g,e=e*h,f=b*f,g=b*g;b*=h;a[0]=1-d-e;a[1]=r+b;a[2]=m-g;a[3]=0;a[4]=r-b;a[5]=1-c-e;a[6]=k+f;a[7]=0;a[8]=m+g;a[9]=k-f;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};l.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),r=1/(e-d),m=1/(f-g);a[0]=2*f*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*f*r;a[6]=0;a[7]=0;a[8]=(c+b)*h;a[9]=(e+d)*r;a[10]=
(g+f)*m;a[11]=-1;a[12]=0;a[13]=0;a[14]=g*f*2*m;a[15]=0;return a};l.perspective=function(a,b,c,d,e){b=1/Math.tan(b/2);var f=1/(d-e);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(e+d)*f;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*e*d*f;a[15]=0;return a};l.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var h=2/(g+b),r=2/(e+f);a[0]=
h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=r;a[6]=0;a[7]=0;a[8]=-((g-b)*h*.5);a[9]=(e-f)*r*.5;a[10]=d/(c-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*c/(c-d);a[15]=0;return a};l.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),r=1/(d-e),m=1/(f-g);a[0]=-2*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*r;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*m;a[11]=0;a[12]=(b+c)*h;a[13]=(e+d)*r;a[14]=(g+f)*m;a[15]=1;return a};l.lookAt=function(a,b,c,d){var e,f,g,h,r,m,k,v,n=b[0],p=b[1];b=b[2];g=d[0];h=d[1];f=d[2];k=c[0];d=c[1];e=c[2];if(Math.abs(n-
k)<q.EPSILON&&Math.abs(p-d)<q.EPSILON&&Math.abs(b-e)<q.EPSILON)return l.identity(a);c=n-k;d=p-d;k=b-e;v=1/Math.sqrt(c*c+d*d+k*k);c*=v;d*=v;k*=v;e=h*k-f*d;f=f*c-g*k;g=g*d-h*c;(v=Math.sqrt(e*e+f*f+g*g))?(v=1/v,e*=v,f*=v,g*=v):g=f=e=0;h=d*g-k*f;r=k*e-c*g;m=c*f-d*e;(v=Math.sqrt(h*h+r*r+m*m))?(v=1/v,h*=v,r*=v,m*=v):m=r=h=0;a[0]=e;a[1]=h;a[2]=c;a[3]=0;a[4]=f;a[5]=r;a[6]=d;a[7]=0;a[8]=g;a[9]=m;a[10]=k;a[11]=0;a[12]=-(e*n+f*p+g*b);a[13]=-(h*n+r*p+m*b);a[14]=-(c*n+d*p+k*b);a[15]=1;return a};l.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};l.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};l.add=function(a,b,
c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};l.subtract=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];
a[13]=b[13]-c[13];a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a};l.sub=l.subtract;l.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*c;a[15]=b[15]*c;return a};l.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*
d;a[8]=b[8]+c[8]*d;a[9]=b[9]+c[9]*d;a[10]=b[10]+c[10]*d;a[11]=b[11]+c[11]*d;a[12]=b[12]+c[12]*d;a[13]=b[13]+c[13]*d;a[14]=b[14]+c[14]*d;a[15]=b[15]+c[15]*d;return a};l.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};l.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],m=a[7],
l=a[8],n=a[9],p=a[10],t=a[11],u=a[12],w=a[13],x=a[14];a=a[15];var y=b[0],z=b[1],B=b[2],C=b[3],A=b[4],E=b[5],F=b[6],K=b[7],H=b[8],L=b[9],M=b[10],N=b[11],G=b[12],O=b[13],P=b[14];b=b[15];return Math.abs(c-y)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(d-z)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(e-B)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(B))&&Math.abs(f-C)<=q.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(g-A)<=q.EPSILON*Math.max(1,Math.abs(g),Math.abs(A))&&
Math.abs(h-E)<=q.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(k-F)<=q.EPSILON*Math.max(1,Math.abs(k),Math.abs(F))&&Math.abs(m-K)<=q.EPSILON*Math.max(1,Math.abs(m),Math.abs(K))&&Math.abs(l-H)<=q.EPSILON*Math.max(1,Math.abs(l),Math.abs(H))&&Math.abs(n-L)<=q.EPSILON*Math.max(1,Math.abs(n),Math.abs(L))&&Math.abs(p-M)<=q.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(t-N)<=q.EPSILON*Math.max(1,Math.abs(t),Math.abs(N))&&Math.abs(u-G)<=q.EPSILON*Math.max(1,Math.abs(u),Math.abs(G))&&Math.abs(w-
O)<=q.EPSILON*Math.max(1,Math.abs(w),Math.abs(O))&&Math.abs(x-P)<=q.EPSILON*Math.max(1,Math.abs(x),Math.abs(P))&&Math.abs(a-b)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};var n={create:function(){var a=new q.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var b=new q.ARRAY_TYPE(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},fromValues:function(a,b,c){var d=new q.ARRAY_TYPE(3);d[0]=a;d[1]=b;d[2]=c;return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,
c,d){a[0]=b;a[1]=c;a[2]=d;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a},subtract:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}};n.sub=n.subtract;n.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a};n.mul=n.multiply;n.divide=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a};n.div=n.divide;n.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};n.floor=
function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};n.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};n.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};n.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);return a};n.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};n.scaleAndAdd=function(a,b,c,
d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;return a};n.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)};n.dist=n.distance;n.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a};n.sqrDist=n.squaredDistance;n.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};n.len=n.length;n.squaredLength=function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a};n.sqrLen=n.squaredLength;n.negate=function(a,
b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};n.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};n.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],c=c*c+d*d+e*e;0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c);return a};n.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};n.cross=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f=c[0],g=c[1];c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f;return a};n.lerp=function(a,b,c,d){var e=b[0],f=b[1];b=b[2];a[0]=e+d*(c[0]-e);a[1]=
f+d*(c[1]-f);a[2]=b+d*(c[2]-b);return a};n.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,k=g*(f-2)+f,m=g*(f-1);f=g*(3-2*f);a[0]=b[0]*h+c[0]*k+d[0]*m+e[0]*f;a[1]=b[1]*h+c[1]*k+d[1]*m+e[1]*f;a[2]=b[2]*h+c[2]*k+d[2]*m+e[2]*f;return a};n.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,k=f*f,m=h*g,h=3*f*h,g=3*k*g;f*=k;a[0]=b[0]*m+c[0]*h+d[0]*g+e[0]*f;a[1]=b[1]*m+c[1]*h+d[1]*g+e[1]*f;a[2]=b[2]*m+c[2]*h+d[2]*g+e[2]*f;return a};n.random=function(a,b){b=b||1;var c=2*q.RANDOM()*Math.PI,d=2*q.RANDOM()-
1,e=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*e;a[1]=Math.sin(c)*e;a[2]=d*b;return a};n.transformMat4=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f=c[3]*d+c[7]*e+c[11]*b+c[15],f=f||1;a[0]=(c[0]*d+c[4]*e+c[8]*b+c[12])/f;a[1]=(c[1]*d+c[5]*e+c[9]*b+c[13])/f;a[2]=(c[2]*d+c[6]*e+c[10]*b+c[14])/f;return a};n.transformMat3=function(a,b,c){var d=b[0],e=b[1];b=b[2];a[0]=d*c[0]+e*c[3]+b*c[6];a[1]=d*c[1]+e*c[4]+b*c[7];a[2]=d*c[2]+e*c[5]+b*c[8];return a};n.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2];b=
c[0];var g=c[1],h=c[2];c=c[3];var k=c*d+g*f-h*e,m=c*e+h*d-b*f,l=c*f+b*e-g*d,d=-b*d-g*e-h*f;a[0]=k*c+d*-b+m*-h-l*-g;a[1]=m*c+d*-g+l*-b-k*-h;a[2]=l*c+d*-h+k*-g-m*-b;return a};n.rotateX=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[0];f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d);f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d);a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a};n.rotateY=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[2]*Math.sin(d)+
e[0]*Math.cos(d);f[1]=e[1];f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d);a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a};n.rotateZ=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d);f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d);f[2]=e[2];a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a};n.forEach=function(){var a=n.create();return function(b,c,d,e,f,g){c||(c=3);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d+=c)a[0]=b[d],a[1]=
b[d+1],a[2]=b[d+2],f(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2];return b}}();n.angle=function(a,b){a=n.fromValues(a[0],a[1],a[2]);b=n.fromValues(b[0],b[1],b[2]);n.normalize(a,a);n.normalize(b,b);b=n.dot(a,b);return 1<b?0:Math.acos(b)};n.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};n.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};n.equals=function(a,b){var c=a[0],d=a[1];a=a[2];var e=b[0],f=b[1];b=b[2];return Math.abs(c-e)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(e))&&
Math.abs(d-f)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(f))&&Math.abs(a-b)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};var x={create:function(){var a=new q.ARRAY_TYPE(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},fromMat4:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(a){var b=new q.ARRAY_TYPE(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=
a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},fromValues:function(a,b,c,d,e,f,g,h,k){var m=new q.ARRAY_TYPE(9);m[0]=a;m[1]=b;m[2]=c;m[3]=d;m[4]=e;m[5]=f;m[6]=g;m[7]=h;m[8]=k;return m},set:function(a,b,c,d,e,f,g,h,k,m){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=f;a[5]=g;a[6]=h;a[7]=k;a[8]=m;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(a===
b){var c=b[1],d=b[2],e=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},invert:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],k=b[6],m=b[7];b=b[8];var l=b*g-h*m,n=-b*f+h*k,p=m*f-g*k,q=c*l+d*n+e*p;if(!q)return null;q=1/q;a[0]=l*q;a[1]=(-b*d+e*m)*q;a[2]=(h*d-e*g)*q;a[3]=n*q;a[4]=(b*c-e*k)*q;a[5]=(-h*c+e*f)*q;a[6]=p*q;a[7]=(-m*c+d*k)*q;a[8]=(g*c-d*f)*q;return a},adjoint:function(a,
b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],k=b[6],m=b[7];b=b[8];a[0]=g*b-h*m;a[1]=e*m-d*b;a[2]=d*h-e*g;a[3]=h*k-f*b;a[4]=c*b-e*k;a[5]=e*f-c*h;a[6]=f*m-g*k;a[7]=d*k-c*m;a[8]=c*g-d*f;return a},determinant:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],f=a[7],g=a[8];return a[0]*(g*c-d*f)+a[1]*(-g*b+d*e)+a[2]*(f*b-c*e)},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],k=b[5],m=b[6],l=b[7];b=b[8];var n=c[0],p=c[1],q=c[2],t=c[3],u=c[4],w=c[5],x=c[6],y=c[7];c=c[8];a[0]=n*d+p*g+q*m;a[1]=
n*e+p*h+q*l;a[2]=n*f+p*k+q*b;a[3]=t*d+u*g+w*m;a[4]=t*e+u*h+w*l;a[5]=t*f+u*k+w*b;a[6]=x*d+y*g+c*m;a[7]=x*e+y*h+c*l;a[8]=x*f+y*k+c*b;return a}};x.mul=x.multiply;x.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],k=b[5],m=b[6],l=b[7];b=b[8];var n=c[0];c=c[1];a[0]=d;a[1]=e;a[2]=f;a[3]=g;a[4]=h;a[5]=k;a[6]=n*d+c*g+m;a[7]=n*e+c*h+l;a[8]=n*f+c*k+b;return a};x.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],k=b[5],m=b[6],l=b[7];b=b[8];var n=Math.sin(c);c=Math.cos(c);a[0]=c*d+
n*g;a[1]=c*e+n*h;a[2]=c*f+n*k;a[3]=c*g-n*d;a[4]=c*h-n*e;a[5]=c*k-n*f;a[6]=m;a[7]=l;a[8]=b;return a};x.scale=function(a,b,c){var d=c[0];c=c[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};x.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};x.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=-c;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};x.fromScaling=
function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};x.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};x.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=c+c,g=d+d,h=e+e,c=c*f,k=d*f,d=d*g,m=e*f,l=e*g,e=e*h,f=b*f,g=b*g;b*=h;a[0]=1-d-e;a[3]=k-b;a[6]=m+g;a[1]=k+b;a[4]=1-c-e;a[7]=l-f;a[2]=m-g;a[5]=l+f;a[8]=1-c-d;return a};x.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],
g=b[4],h=b[5],k=b[6],m=b[7],l=b[8],n=b[9],p=b[10],q=b[11],t=b[12],u=b[13],w=b[14];b=b[15];var x=c*h-d*g,y=c*k-e*g,B=c*m-f*g,C=d*k-e*h,A=d*m-f*h,z=e*m-f*k,E=l*u-n*t,F=l*w-p*t,l=l*b-q*t,H=n*w-p*u,n=n*b-q*u,p=p*b-q*w,q=x*p-y*n+B*H+C*l-A*F+z*E;if(!q)return null;q=1/q;a[0]=(h*p-k*n+m*H)*q;a[1]=(k*l-g*p-m*F)*q;a[2]=(g*n-h*l+m*E)*q;a[3]=(e*n-d*p-f*H)*q;a[4]=(c*p-e*l+f*F)*q;a[5]=(d*l-c*n-f*E)*q;a[6]=(u*z-w*A+b*C)*q;a[7]=(w*B-t*z-b*y)*q;a[8]=(t*A-u*B+b*x)*q;return a};x.str=function(a){return"mat3("+a[0]+", "+
a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};x.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};x.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];return a};x.subtract=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-
c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];return a};x.sub=x.subtract;x.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;return a};x.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*d;a[8]=b[8]+c[8]*d;return a};x.exactEquals=function(a,
b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};x.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7];a=a[8];var n=b[0],p=b[1],t=b[2],u=b[3],w=b[4],x=b[5],y=b[6],z=b[7];b=b[8];return Math.abs(c-n)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(n))&&Math.abs(d-p)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(p))&&Math.abs(e-t)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))&&Math.abs(f-u)<=q.EPSILON*
Math.max(1,Math.abs(f),Math.abs(u))&&Math.abs(g-w)<=q.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(h-x)<=q.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(k-y)<=q.EPSILON*Math.max(1,Math.abs(k),Math.abs(y))&&Math.abs(l-z)<=q.EPSILON*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(a-b)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};var y=function(a,b){var c=void 0===b?{}:b;b=void 0===c.vertex?"":c.vertex;var d=void 0===c.fragment?"":c.fragment,e=void 0===c.uniforms?[]:c.uniforms,c=void 0===
c.mode?"":c.mode;this.vao=ca(a);this.gl=a;this.model=l.create();this.modelView=l.create();this.rotation={x:0,y:0,z:0};this.attributes={};this.numVertices=3;this.normalMatrix=x.create();this.mode=""!==c?c:a.TRIANGLES;this.setNumInstances();this.rotateAxis=n.create();n.set(this.rotateAxis,this.rotation.x,this.rotation.y,this.rotation.z);this.scaleSize=n.create();this.position=n.create();""!==b&&""!==d&&this.setShader({vertex:b,fragment:d,uniforms:e})};y.prototype.setShader=function(a){var b=void 0===
a?{}:a;a=void 0===b.vertex?"":b.vertex;var c=void 0===b.fragment?"":b.fragment,b=void 0===b.uniforms?[]:b.uniforms;""!==a&&""!==c&&(b=[].concat($jscomp.arrayFromIterable("projectionMatrix modelMatrix modelViewMatrix normalMatrix viewMatrix time uTime".split(" ")),$jscomp.arrayFromIterable(b)),this.shader=ea(this.gl,{vertex:a,fragment:c,uniforms:b}),this.shaderSet=!0)};y.prototype.addAttribute=function(a,b,c,d){c=void 0===c?3:c;d=void 0===d?{}:d;if(this.shaderSet){var e=S(this.gl);b[0]instanceof Array&&
(b=u(b,c));this.vao.bind();e.bind();e.bufferData(b);this.vao.addAttribute(this.shader,a,{size:c,dataOptions:d});e.unbind();this.vao.unbind();this.attributes[a]=e;return this}};y.prototype.addAttributeBuffer=function(a,b){if(this.shaderSet)return this.vao.bind(),b.bind(),this.vao.addAttribute(this.shader,a,{size:size,dataOptions:dataOptions}),b.unbind(),this.vao.unbind(),this.attributes[a]=b,this};y.prototype.updateRawBuffer=function(a,b,c){var d=void 0===c?{}:c;c=void 0===d.size?3:d.size;var d=d.dataOptions,
e=this.gl;this.vao.bind();e.bindBuffer(e.ARRAY_BUFFER,b);this.vao.addAttribute(this.shader,a,{size:c,dataOptions:d});e.bindBuffer(e.ARRAY_BUFFER,null);this.vao.unbind()};y.prototype.addInstancedAttributeBuffer=function(a,b,c){var d=void 0===c?{}:c;c=void 0===d.size?3:d.size;d=d.dataOptions;if(this.shaderSet){var e=this.gl;b instanceof WebGLBuffer?(this.vao.bind(),e.bindBuffer(e.ARRAY_BUFFER,b),this.vao.addAttribute(this.shader,a,{size:c,dataOptions:d}),this.vao.makeInstancedAttribute(a),e.bindBuffer(e.ARRAY_BUFFER,
null)):(this.vao.bind(),b.bind(),this.vao.addAttribute(this.shader,a,{size:c,dataOptions:d}),this.vao.makeInstancedAttribute(a),b.unbind());this.vao.unbind();this.attributes[a]=b;return this}};y.prototype.addInstancedAttribute=function(a,b,c,d){c=void 0===c?3:c;d=void 0===d?{}:d;if(this.shaderSet){var e=S(this.gl);b[0]instanceof Array&&(b=u(b,c));this.vao.bind();e.bind();e.bufferData(b);this.vao.addAttribute(this.shader,a,{size:c,dataOptions:d});this.vao.makeInstancedAttribute(a);e.unbind();this.vao.unbind();
this.attributes[a]=e;this.instanced=!0;return this}};y.prototype.updateAttribute=function(a,b){a=this.attributes[a];this.vao.bind();a.bind();a.updateBuffer(b);a.unbind();this.vao.unbind()};y.prototype.setNumVertices=function(a,b){this.indicesSet||(10<a&&(a/=void 0===b?3:b),this.numVertices=a);return a};y.prototype.addIndices=function(a){if(this.shaderSet){var b=S(this.gl,{indexed:!0});a[0]instanceof Array&&(a=u(a));this.vao.bind();b.bind();b.bufferData(a);this.vao.unbind();b.unbind();this.indicesSet=
!0;this.numVertices=a.length;return this}};y.prototype.setNumInstances=function(a){this.instanced&&(this.numInstances=void 0===a?1:a)};y.prototype.draw=function(a,b){this.shaderSet&&(this.shader.bind(),this.calculateNormalMatrix(a.view),this.shader.set4x4Uniform("projectionMatrix",a.projection),this.shader.set4x4Uniform("modelViewMatrix",a.view),this.shader.set3x3Uniform("normalMatrix",this.normalMatrix),this.shader.uniform("viewMatrix",a.view),this.shader.uniform("view",a.view),this.shader.uniform("modelMatrix",
this.model),this.shader.uniform("model",this.model),void 0!==b&&b(this.shader),this.vao.bind(),this.indicesSet&&!this.instanced?this.gl.drawElements(this.mode,this.numVertices,UNSIGNED_SHORT,0):this.instanced||this.gl.drawArrays(this.mode,0,this.numVertices),this.indicesSet&&this.instanced&&this.gl.drawInstancedElements(this.mode,this.numVertices,this.numInstances),this.vao.unbind())};y.prototype.drawOrtho=function(a,b){this.shaderSet&&(this.shader.bind(),void 0!==b&&b(this.shader),this.vao.bind(),
this.indicesSet&&!this.instanced?this.gl.drawElements(this.mode,this.numVertices,UNSIGNED_SHORT,0):this.instanced||this.gl.drawArrays(this.mode,0,this.numVertices),this.indicesSet&&this.instanced&&this.gl.drawInstancedElements(this.mode,this.numVertices,this.numInstances),this.vao.unbind())};y.prototype.update=function(){};y.prototype.translate=function(a,b,c){n.set(this.position,void 0===a?1:a,void 0===b?1:b,void 0===c?0:c);l.translate(this.model,this.model,this.position)};y.prototype.translateX=
function(a){n.set(this.position,a,this.position[1],this.position[2]);l.translate(this.model,this.model,this.position)};y.prototype.translateY=function(a){n.set(this.position,this.position[0],a,this.position[2]);l.translate(this.model,this.model,this.position)};y.prototype.translateZ=function(a){n.set(this.position,this.position[0],this.position[1],a);l.translate(this.model,this.model,this.position)};y.prototype.scaleModel=function(a,b,c){n.set(this.scaleSize,void 0===a?1:a,void 0===b?1:b,void 0===
c?1:c);l.scale(this.model,this.model,this.scaleSize);return this};y.prototype.rotateX=function(a){a=a*Math.PI/180;l.rotateX(this.model,this.model,a);return this};y.prototype.rotateY=function(a){a=a*Math.PI/180;l.rotateY(this.model,this.model,a);return this};y.prototype.rotateZ=function(a){a=a*Math.PI/180;l.rotateZ(this.model,this.model,a);return this};y.prototype.scale=function(a){a instanceof Array&&4>a.length&&(l.scale(this.model,this.model,a),this.scaleSize.x=a[0],this.scaleSize.y=a[1],this.scaleSize.x=
a[2]);return this};y.prototype.calculateNormalMatrix=function(a){var b=this.model,c=this.normalMatrix,d=this.modelView;l.identity(d);x.identity(c);l.multiply(d,b,a);x.fromMat4(c,d);x.invert(c,c);x.transpose(c,c);return this.normalMatrix=c};var E=function(a,b){var c=void 0===b?{}:b;b=void 0===c.imgWidth?705:c.imgWidth;var d=void 0===c.imgHeight?850:c.imgHeight,e=void 0===c.images?[]:c.images,c=void 0===c.radius?100:c.radius,f=this;this.threshold=.3;this.props={mix:1};this.images=e;this.gl=a;this.width=
b;this.height=d;this.numImages=e.length-1;this.index=0;this.currentTexture=this.images[this.index].texture;this.nextTexture=this.images[this.index].texture;this.isAnimating=this.animateTransition=!1;var g=new Image;g.src="/img/transition.png";g.onload=function(){f.mixTexture=L(a,{data:g});f.mixTextureLoaded=!0};this.radius=c;this._buildBuffers();this._buildPositions();this.isAnimating=!1};E.prototype.tweenProps=function(){var a=this;TweenMax.to(this.props,1,{mix:0,onComplete:function(){a.animateTransition=
!1;a.currentTexture=a.nextTexture;a.props.mix=1;a.isAnimating=!1}})};E.prototype.next=function(){this.isAnimating||(this.nextTexture=this.images[this.getNextImage()].texture,this._animateNext(),this.isAnimating=!0);this.tweenProps()};E.prototype.previous=function(){this.isAnimating||(this.nextTexture=this.images[this.getPreviousImage()].texture,this._animatePrevious(),this.isAnimating=!0);this.tweenProps()};E.prototype._animateNext=function(){this.animateTransition=!0;this.index+1<this.numImages&&
this.index++};E.prototype._animatePrevious=function(){this.animateTransition=!0;0<this.index&&--this.index};E.prototype.getNextImage=function(){return this.index<this.numImages?this.index+1:0};E.prototype.getPreviousImage=function(){return 0!==this.index?this.index:0};E.prototype.draw=function(a){var b=this,c=this.gl;this.time+=.01;this.mixTextureLoaded&&(this.currentTexture.bind(),this.nextTexture.bind(1),this.mixTexture.bind(2),this.mesh.draw(a,function(a){a.setBooleanUniform("animateTransition",
b.animateTransition);a.uniform("threshold",b.threshold);a.setTextureUniform("currentImage",0);a.setTextureUniform("nextImage",1);a.setTextureUniform("mixTexture",2);a.uniform("mixRatio",b.props.mix)}),c.clearTextures())};E.prototype._buildPositions=function(){for(var a=this.gl,b=.5*this.width,c=.5*this.height,d=[],e=[],f=[],g=[],h=[],k=b/1,l=c/1,n=0;n<=l;n++)for(var p=0;p<=k;p++){var q=p/k,t=n/l,q=1-q,t=1-t;d.push([1*p-b/2,-1*n+c/2,0]);e.push([0,0,0]);f.push([q,t]);g.push([0,0,1]);n<l&&p<k&&(h.push([n*
(k+1)+p,(n+1)*(k+1)+p+1,n*(k+1)+p+1]),h.push([(n+1)*(k+1)+p+1,n*(k+1)+p,(n+1)*(k+1)+p]))}b=Math.PI/180;c=[];for(e=0;360>e;++e)g=e*b,c.push(Math.cos(g)*this.radius,Math.sin(g)*this.radius,0);k=h=g=e=1;b=[];l=[];n=[];c=[];for(p=0;p<=k;p++)for(q=0;q<=h;q++){var t=q/h,u=p/k;b.push([-e/2+t*e,g/2-u*g,0]);l.push([t,1-u]);n.push([0,0,1]);p<k&&q<h&&(c.push([p*(h+1)+q,(p+1)*(h+1)+q+1,p*(h+1)+q+1]),c.push([(p+1)*(h+1)+q+1,p*(h+1)+q,(p+1)*(h+1)+q]))}a=new y(a,{vertex:"uniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nin vec3 position;\r\nin vec3 ppos;\r\nin vec2 uv;\r\nout vec2 vUv;\r\nvoid main(){\r\n    vec3 pos \x3d position + ppos;\r\n\r\n    vUv \x3d uv;\r\n\r\n    gl_Position \x3d projectionMatrix * viewMatrix * vec4(pos,1.);\r\n}\r\n",
fragment:"\r\nuniform sampler2D currentImage;\r\nuniform sampler2D nextImage;\r\nuniform sampler2D mixTexture;\r\nuniform float threshold;\r\nuniform float mixRatio;\r\n\r\nuniform bool animateTransition;\r\n\r\nin vec2 vUv;\r\nout vec4 glFragColor;\r\n\r\nvoid main(){\r\n\r\n     // current texture to show\r\n       vec4 currentTex \x3d texture(currentImage,vUv);\r\n\r\n       // next texture to show\r\n       vec4 nextTex \x3d texture(nextImage,vUv);\r\n\r\n\r\n       // mixture texture.\r\n       vec4 mixTex \x3d texture(mixTexture,vUv);\r\n\r\n       vec4 finalColor \x3d vec4(0.);\r\n\r\n\r\n        \tfloat r \x3d mixRatio * (1.0 + threshold * 2.0) - threshold;\r\n            float mixf\x3dclamp((mixTex.r - r)*(1.0/threshold), 0.0, 1.0);\r\n        if(animateTransition){\r\n             finalColor \x3d mix(currentTex,nextTex,mixf);\r\n        }else{\r\n            finalColor \x3d currentTex;\r\n        }\r\n\r\n\r\n        glFragColor \x3d finalColor;\r\n}\r\n\r\n",
uniforms:"time currentImage previousImage nextImage mixRatio threshold mixTexture endOfList beginningOfList animateTransition".split(" ")});a.addAttribute("position",b);a.addInstancedAttribute("ppos",d);a.addInstancedAttribute("uv",f,2);a.addIndices(c);a.numInstances=d.length;this.mesh=a};E.prototype._buildBuffers=function(){for(var a=this.gl,b=[],c=[],d=0;4>d;++d)b.push(L(a,{width:this.width,height:this.height,floatingPoint:!0})),c.push(L(a,{width:this.width,height:this.height,floatingPoint:!0}));
this.target=W(a,{format:V(a,{textures:b})});this.current=W(a,{format:V(a,{textures:c})})};var M=function(a){var b=this,c=O().setFullscreen().attachToScreen(),d=aa(),d=K(d,-40);window.addEventListener("resize",function(){var a=d;a.aspect=window.innerWidth/window.innerHeight;l.perspective(a.projection,a.fov,a.aspect,a.near,a.far);d=a});this.gl=c;this.camera=d;this.assets=a;this._buildThumbnails().then(function(a){a.getByProject=function(a){var b=[];this.forEach(function(c){c.item.projectName===a&&b.push(c)});
return b};b.assets=a;b._buildScene();b.animate()})};M.prototype._buildScene=function(){var a=this,b=new E(this.gl,{images:this.assets});this.particles=b;this._isMobile()?(this.interact=new Hammer.Manager(window),this.interact.add(new Hammer.Pan({direction:Hammer.DIRECTION_ALL,threshold:300})),this.interact.on("pan",function(b){a.handlePan(b)})):window.addEventListener("keydown",function(a){switch(a.keyCode){case 38:b.next();break;case 40:b.previous()}})};M.prototype._isMobile=function(){return-1!==
navigator.userAgent.search("Android|webOS|iPhone|iPad|iPod|BlackBerry")?!0:!1};M.prototype.handlePan=function(a){switch(a.additionalEvent){case "panup":this.particles.next();break;case "pandown":this.particles.previous()}};M.prototype._buildThumbnails=function(){var a=this,b=[];this.assets.forEach(function(c){b.push(fa(a.gl,c))});return Promise.all(b)};M.prototype.animate=function(){function a(e){requestAnimationFrame(a);b.clearScreen();d.draw(c)}var b=this.gl,c=this.camera,d=this.particles;a()};
var ha=[{id:"strava",content:"",src:"/demos/webgl-image-gallery/img/1.jpg",projectName:"strava"},{id:"google",content:"",src:"/demos/webgl-image-gallery/img/2.jpg"},{id:"apple",content:"",src:"/demos/webgl-image-gallery/img/3.jpg"}],P=function(){this.loaded=[];this.queue=new createjs.LoadQueue(!0)};P.prototype.onProgress=function(a){this.queue.on("progress",a);return this};P.prototype.onFileComplete=function(a){this.onFileCompleteBound||(this.queue.on("fileload",a),this.onFileCompleteBound=!0);return this};P.prototype.onComplete=function(a){var b=this;this.onCompleteBound||
(this.queue.on("complete",function(c){b.loaded=b.queue.getItems();a(b.loaded,c)}),this.onCompleteBound=!0);return this};P.prototype.loadManifest=function(a){this.queue.loadManifest(a);return this};"serviceWorker"in navigator?ga().then(function(){X()}):X()});